<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ë²„ë¸” ìŠ¤í”„ë¦°íŠ¸: ìƒì–´ í”¼í•˜ê¸°</title>
  <style>
    :root {
      --ui-bg: rgba(255,255,255,0.22);
      --ui-border: rgba(255,255,255,0.32);
      --text: rgba(255,255,255,0.95);
      --muted: rgba(255,255,255,0.75);
      --shadow: rgba(0,0,0,0.12);
    }
#fishWrap{
  position: absolute;
  left: 50%;
  top: 55%;
  transform: translate(-50%, -50%);
  z-index: 2;
  pointer-events: none;
  animation: fishFloat 2.6s ease-in-out infinite;
}

@keyframes fishFloat{
  0%   { transform: translate(-50%, -50%) translate(0px, 0px); }
  50%  { transform: translate(-50%, -50%) translate(8px, -12px); }
  100% { transform: translate(-50%, -50%) translate(0px, 0px); }
}
/* ===== ìœ„í—˜ë„ í…Œë‘ë¦¬ ê²½ê³ (ì´ˆë¡â†’ë…¸ë‘â†’ë¹¨ê°•) ===== */
#edgeGlow{
  position:absolute;
  inset: 10px;
  border-radius: 22px;
  pointer-events:none;
  z-index: 9; /* HUD(10) ì•„ë˜, ê²Œì„ ìš”ì†Œ ìœ„ ëŠë‚Œ */
  opacity: 0;
  box-shadow:
    0 0 0 3px rgba(255,255,255,0.18) inset,
    0 0 0 0 rgba(0,0,0,0),
    0 0 40px 0 rgba(0,0,0,0);
  transition: opacity 120ms ease;
}

/* JSê°€ ì´ ë³€ìˆ˜ë¥¼ ë°”ê¿”ì„œ ìƒ‰/ê°•ë„ë¥¼ ì¡°ì ˆí•  ê±°ì•¼ */
#edgeGlow{
  --edge: rgba(80,255,170,0.0);
  box-shadow:
    0 0 0 3px rgba(255,255,255,0.18) inset,
    0 0 0 6px color-mix(in srgb, var(--edge) 55%, transparent),
    0 0 50px 10px color-mix(in srgb, var(--edge) 55%, transparent);
}

/* ===== âœ¨ íŒŒí‹°í´ ===== */
.spark{
  position:absolute;
  left: 0;
  top: 0;
  font-size: 18px;
  transform: translate(-50%, -50%);
  pointer-events:none;
  z-index: 12; /* ë²„ë¸”(4)ê³¼ HUD(10)ë³´ë‹¤ ìœ„ */
  will-change: transform, opacity;
  animation: sparkPop 520ms ease-out forwards;
  filter: drop-shadow(0 6px 10px rgba(0,0,0,0.12));
}

@keyframes sparkPop{
  0%   { opacity: 0; transform: translate(-50%, -50%) translate(0,0) scale(0.6); }
  15%  { opacity: 1; transform: translate(-50%, -50%) translate(0,0) scale(1.0); }
  100% { opacity: 0; transform: translate(-50%, -50%) translate(var(--dx), var(--dy)) scale(1.1); }
}

    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      background: #0a7bd8;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      user-select: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    /* ê²Œì„ í™”ë©´: í„°ì¹˜ ìŠ¤í¬ë¡¤/ì¤Œ ë°©ì§€ */
  #game{
  position: relative;
  width: 100vw;
  height: 100vh;
  touch-action: none;
  overflow: hidden;

  background:
    radial-gradient(900px 520px at 20% 12%, rgba(255,255,255,0.55), transparent 60%),
    radial-gradient(820px 520px at 82% 18%, rgba(200,255,245,0.55), transparent 62%),
    radial-gradient(1200px 900px at 50% 120%, rgba(0,180,160,0.35), transparent 55%),
    linear-gradient(
      180deg,
      #8af2e1 0%,
      #54e1d4 30%,
      #2fc7cf 55%,
      #149fbf 80%,
      #0a78a8 100%
    );
}
#game::before{
  content:"";
  position:absolute;
  inset:-30%;
  background:
    radial-gradient(circle at 25% 22%, rgba(255,255,255,0.40), transparent 35%),
    radial-gradient(circle at 68% 30%, rgba(255,255,255,0.32), transparent 38%),
    radial-gradient(circle at 42% 72%, rgba(255,255,255,0.26), transparent 40%);
  opacity: 0.6;
  filter: blur(0.6px);
  animation: shimmer 6.5s ease-in-out infinite;
  pointer-events:none;
  z-index:1;
}

@keyframes shimmer{
  0%   { transform: translate(-2%, -1%) rotate(0deg); }
  50%  { transform: translate(2%, 1%) rotate(1.2deg); }
  100% { transform: translate(-2%, -1%) rotate(0deg); }
}
    /* ì”ì”í•œ ë²„ë¸” ë°°ê²½(ë‹¨ìˆœ, ê°€ë²¼ì›€) */
    .bg-bubble {
      position: absolute;
      border-radius: 999px;
      background: rgba(255,255,255,0.18);
      filter: blur(0.3px);
      opacity: 0.7;
      pointer-events: none;
      animation: floatUp linear infinite;
    }
    @keyframes floatUp {
      from { transform: translateY(10vh); }
      to   { transform: translateY(-120vh); }
    }

    /* ìƒë‹¨ HUD */
    #hud {
      position: absolute;
      top: 12px;
      left: 12px;
      right: 12px;
      display: flex;
      gap: 10px;
      align-items: stretch;
      z-index: 10;
    }

    .card {
      flex: 1;
      background: var(--ui-bg);
      border: 1px solid var(--ui-border);
      border-radius: 14px;
      padding: 10px 12px;
      box-shadow: 0 10px 30px var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: var(--text);
      min-width: 0;
    }

    .row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 10px;
    }

    .label {
      font-size: 12px;
      color: var(--muted);
      letter-spacing: 0.2px;
      white-space: nowrap;
    }

    .value {
      font-size: 18px;
      font-weight: 700;
      white-space: nowrap;
    }

    /* ìœ„í—˜ë„ ê²Œì´ì§€ */
    #dangerWrap {
      margin-top: 8px;
      height: 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.22);
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.18);
    }

    #dangerBar {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(84,255,186,0.95), rgba(255,214,94,0.95), rgba(255,88,88,0.95));
      transform-origin: left center;
    }

    /* ê°€ìš´ë° í”Œë ˆì´ì–´ ë¬¼ê³ ê¸°(ì¥ì‹) */
   #fish{
  width: clamp(80px, 12vw, 130px);
  height: auto;

  filter: drop-shadow(0 10px 18px rgba(0,0,0,0.18));
  opacity: 0.95;

  transform-origin: 30% 50%;
  animation: fishSwim 0.6s ease-in-out infinite;
}

    /* í´ë¦­ íƒ€ê²Ÿ(ê±°í’ˆ) */
  .bubble{
  position:absolute;
  width: 72px;
  height: 72px;
  border-radius: 999px;
  display:grid;
  place-items:center;
  font-size: 32px;

  background:
    radial-gradient(circle at 28% 26%, rgba(255,255,255,0.95), rgba(255,255,255,0.35) 35%, rgba(255,255,255,0.18) 70%),
    radial-gradient(circle at 70% 74%, rgba(255,255,255,0.28), transparent 55%);
  border: 2px solid rgba(255,255,255,0.55);

  box-shadow: 0 16px 34px rgba(0,0,0,0.12);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index:4;
  transform: translateZ(0);
  transition: transform 90ms ease;
}

.bubble::after{
  content:"";
  position:absolute;
  width: 18px;
  height: 18px;
  border-radius: 999px;
  left: 14px;
  top: 14px;
  background: rgba(255,255,255,0.75);
  filter: blur(0.2px);
  opacity: 0.9;
}

.bubble:active{
  transform: scale(0.96);
}

    /* í•˜ë‹¨ ë©”ì‹œì§€ */
    #tip {
      position: absolute;
      left: 12px;
      right: 12px;
      bottom: 12px;
      z-index: 10;
      background: var(--ui-bg);
      border: 1px solid var(--ui-border);
      border-radius: 14px;
      padding: 10px 12px;
      box-shadow: 0 10px 30px var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: var(--text);
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }
    #tipText { color: var(--text); }
    #startBtn {
      border: none;
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.85);
      color: rgba(0,0,0,0.75);
      font-weight: 800;
      cursor: pointer;
    }
    #startBtn:active { transform: scale(0.98); }

    /* ìƒì–´ ë“±ì¥(ìœ„í—˜í•  ë•Œë§Œ) */
    #shark {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      font-size: clamp(64px, 10vw, 110px);
      opacity: 0;
      pointer-events: none;
      z-index: 6;
      transition: opacity 180ms ease, transform 180ms ease;
      filter: drop-shadow(0 14px 26px rgba(0,0,0,0.22));
    }
    #shark.show {
      opacity: 0.95;
      transform: translate(-50%, -50%) scale(1);
    }

    /* ì¡í˜”ì„ ë•Œ ì˜¤ë²„ë ˆì´ */
    #overlay {
      position: absolute;
      inset: 0;
      display: none;
      place-items: center;
      background: rgba(0,0,0,0.25);
      z-index: 20;
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }
    #overlay.show { display: grid; }

    #panel {
      width: min(520px, calc(100vw - 24px));
      background: rgba(255,255,255,0.22);
      border: 1px solid rgba(255,255,255,0.35);
      border-radius: 18px;
      padding: 16px;
      color: var(--text);
      box-shadow: 0 18px 50px rgba(0,0,0,0.18);
      text-align: center;
    }
    #panel h1 {
      margin: 8px 0 6px;
      font-size: 22px;
    }
    #panel p {
      margin: 6px 0;
      color: rgba(255,255,255,0.88);
    }
    #againBtn {
      margin-top: 12px;
      border: none;
      border-radius: 14px;
      padding: 12px 14px;
      background: rgba(255,255,255,0.88);
      color: rgba(0,0,0,0.75);
      font-weight: 900;
      cursor: pointer;
      width: 100%;
    }
    #againBtn:active { transform: scale(0.99); }

    /* ì‘ì€ í™”ë©´ì—ì„œ HUD ì¤„ë°”ê¿ˆ ë°©ì§€ */
    @media (max-width: 420px) {
      #hud { flex-direction: column; }
      .card { flex: none; }
    }
@keyframes fishSwim{
  0%   { transform: scaleX(-1) rotate(-6deg); }
  50%  { transform: scaleX(-1) rotate(6deg); }
  100% { transform: scaleX(-1) rotate(-6deg); }
}
    .value, .label {
  text-shadow: 0 2px 6px rgba(0,0,0,0.35);
}

#tipText {
  text-shadow: 0 2px 8px rgba(0,0,0,0.45);
}
  </style>
</head>

<body>
  <div id="game" aria-label="ê²Œì„ í™”ë©´">
    <div id="hud">
      <div class="card">
        <div class="row">
          <div class="label">ì ìˆ˜</div>
          <div class="value"><span id="score">0</span> ğŸ«§</div>
        </div>
        <div class="row" style="margin-top:6px;">
          <div class="label">ì½¤ë³´</div>
          <div class="value"><span id="combo">0</span> âœ¨</div>
        </div>
      </div>
      <div class="card">
        <div class="row">
          <div class="label">ë‚¨ì€ ì‹œê°„</div>
          <div class="value"><span id="time">40.0</span>s</div>
        </div>
        <div class="label" style="margin-top:8px;">ìƒì–´ ìœ„í—˜ë„</div>
        <div id="dangerWrap" aria-label="ìœ„í—˜ë„ ê²Œì´ì§€">
          <div id="dangerBar"></div>
        </div>
      </div>
    </div>
    <div id="edgeGlow" aria-hidden="true"></div>
 <div id="fishWrap" aria-hidden="true">
  <img id="fish" src="clownfish.png" alt="ë¬¼ê³ ê¸°" />
</div>
    <div id="shark" aria-hidden="true">ğŸ¦ˆ</div>

    <div id="tip">
      <div id="tipText">ğŸ«§ ê±°í’ˆì„ ë¹¨ë¦¬ ëˆŒëŸ¬ì„œ ìƒì–´ë¥¼ ë”°ëŒë¦¬ì! (í„°ì¹˜/í´ë¦­)</div>
      <button id="startBtn" type="button">ì‹œì‘</button>
    </div>

    <div id="overlay">
      <div id="panel">
        <div style="font-size:56px; margin-top: 2px;">ğŸ¦ˆ</div>
        <h1 id="resultTitle">ì¡í˜”ë‹¤!</h1>
        <p id="resultLine">ì ìˆ˜ 0, ìµœê³  ì½¤ë³´ 0</p>
        <p id="resultBadge">ì¹­í˜¸: </p>
        <button id="againBtn" type="button">ë‹¤ì‹œ í•˜ê¸°</button>
      </div>
    </div>
  </div>

  <script>
    (() => {
      const elGame = document.getElementById('game');
      const elScore = document.getElementById('score');
      const elCombo = document.getElementById('combo');
      const elTime = document.getElementById('time');
      const elDangerBar = document.getElementById('dangerBar');
      const elShark = document.getElementById('shark');
      const elOverlay = document.getElementById('overlay');
      const elStartBtn = document.getElementById('startBtn');
      const elAgainBtn = document.getElementById('againBtn');
      const elTipText = document.getElementById('tipText');
      const elResultTitle = document.getElementById('resultTitle');
      const elResultLine = document.getElementById('resultLine');
      const elResultBadge = document.getElementById('resultBadge');
      const elEdgeGlow = document.getElementById('edgeGlow');
      const elHud = document.getElementById('hud');
      const elTip = document.getElementById('tip');
function burstSparks(x, y) {
  const count = 10;
  for (let i = 0; i < count; i++) {
    const s = document.createElement('span');
    s.className = 'spark';
    s.textContent = 'âœ¨';

    // ëœë¤ ë°©í–¥/ê±°ë¦¬
    const ang = Math.random() * Math.PI * 2;
    const dist = 26 + Math.random() * 34;
    const dx = Math.cos(ang) * dist;
    const dy = Math.sin(ang) * dist;

    s.style.left = x + 'px';
    s.style.top = y + 'px';
    s.style.setProperty('--dx', dx.toFixed(1) + 'px');
    s.style.setProperty('--dy', dy.toFixed(1) + 'px');

    elGame.appendChild(s);
    s.addEventListener('animationend', () => s.remove());
  }
}
      // ====== ê²Œì„ ì„¤ì •ê°’ ======
      const ROUND_SECONDS = 40.0;

      // ë²„ë¸” ìƒì„± í…œí¬(ëœë¤ ë²”ìœ„)
      const SPAWN_MIN_MS = 520;
      const SPAWN_MAX_MS = 980;

      // ë²„ë¸”ì´ í™”ë©´ì— ë‚¨ëŠ” ì‹œê°„(ì ì  ì§§ì•„ì§)
      const BUBBLE_LIFE_START_MS = 760;
      const BUBBLE_LIFE_MIN_MS   = 460;

      // ìœ„í—˜ë„ ì‹œìŠ¤í…œ
      // - ì‹œê°„ì´ íë¥¼ìˆ˜ë¡ ìœ„í—˜ë„ ìƒìŠ¹(ìƒì–´ê°€ ë‹¤ê°€ì˜´)
      // - ë²„ë¸” í´ë¦­í•˜ë©´ ìœ„í—˜ë„ ê°ì†Œ(ë„ë§ ì„±ê³µ)
      const DANGER_RISE_PER_SEC = 12.0;   // ì´ˆë‹¹ ìƒìŠ¹
      const DANGER_DROP_ON_HIT  = 11.0;   // í´ë¦­ ì‹œ ê°ì†Œ
      const DANGER_PENALTY_MISS = 9.5;    // ë²„ë¸” ë†“ì¹˜ë©´(ì‚¬ë¼ì§) ì¶”ê°€ ìƒìŠ¹

      const SHARK_SHOW_AT = 85;           // 85% ì´ìƒì´ë©´ ìƒì–´ ì•„ì´ì½˜ ë“±ì¥
      const CAUGHT_AT = 100;              // 100%ë©´ ì¡í˜(ê²Œì„ì˜¤ë²„)

      // ====== ìƒíƒœ ======
      let running = false;
      let score = 0;
      let combo = 0;
      let bestCombo = 0;
      let danger = 0;           // 0~100
      let timeLeft = ROUND_SECONDS;
      let spawnTimer = null;
      let tickRAF = 0;
      let lastTick = 0;
      let activeBubble = null;
      let bubbleLifeMs = BUBBLE_LIFE_START_MS;

      // ====== ìœ í‹¸ ======
      function clamp(v, a, b) { return Math.max(a, Math.min(b, v)); }
      function rand(min, max) { return Math.random() * (max - min) + min; }

      function setDanger(next) {
        danger = clamp(next, 0, 110);
        const pct = clamp(danger, 0, 100);
        elDangerBar.style.width = pct + '%';

        if (pct >= SHARK_SHOW_AT && pct < CAUGHT_AT && running) {
          elShark.classList.add('show');
        } else {
          elShark.classList.remove('show');
        }
      // ===== í…Œë‘ë¦¬ ê²½ê³  ì—…ë°ì´íŠ¸ =====
const pct2 = clamp(danger, 0, 100);

// 0~70ì€ ê±°ì˜ í‘œì‹œ ì•ˆ í•¨, 70~100ì—ì„œ ì ì  ê°•í•´ì§
const t = clamp((pct2 - 70) / 30, 0, 1);

// ìƒ‰ìƒ: ì´ˆë¡(120) â†’ ë…¸ë‘(55) â†’ ë¹¨ê°•(0)
let hue;
if (pct2 < 85) {
  const k = clamp((pct2 - 70) / 15, 0, 1);     // 70~85
  hue = 120 + (55 - 120) * k;                  // 120â†’55
} else {
  const k = clamp((pct2 - 85) / 15, 0, 1);     // 85~100
  hue = 55 + (0 - 55) * k;                     // 55â†’0
}

// í…Œë‘ë¦¬ ìƒ‰/íˆ¬ëª…ë„
const alpha = 0.20 + 0.55 * t;
elEdgeGlow.style.setProperty('--edge', `hsla(${hue}, 95%, 58%, ${alpha})`);
elEdgeGlow.style.opacity = String(0.10 + 0.90 * t);}

      function updateHUD() {
        elScore.textContent = String(score);
        elCombo.textContent = String(combo);
        elTime.textContent = timeLeft.toFixed(1);
      }

      function setTip(text) {
        elTipText.textContent = text;
      }

      // ====== ë°°ê²½ ë²„ë¸”(ê°€ë²¼ìš´ ì¥ì‹) ======
      function makeBgBubbles() {
        // ë„ˆë¬´ ë§ì´ ë§Œë“¤ë©´ ë¶€ë‹´ë  ìˆ˜ ìˆì–´ì„œ ì ë‹¹íˆ
        const count = 14;
        for (let i = 0; i < count; i++) {
          const b = document.createElement('div');
          b.className = 'bg-bubble';
          const size = rand(14, 44);
          b.style.width = size + 'px';
          b.style.height = size + 'px';
          b.style.left = rand(0, 100) + 'vw';
          b.style.top = rand(0, 120) + 'vh';
          b.style.animationDuration = rand(6, 14) + 's';
          b.style.opacity = rand(0.35, 0.75);
          elGame.appendChild(b);
        }
      }

      // ====== ë²„ë¸” ìƒì„±/ì‚­ì œ ======
      function removeActiveBubble() {
        if (!activeBubble) return;
        activeBubble.remove();
        activeBubble = null;
      }

      function spawnBubble() {
  if (!running) return;

  removeActiveBubble();

  // âœ… ë²„ë¸” ìƒì„±(ì´ê²Œ ì—†ì–´ì„œ ì§€ê¸ˆ ê²Œì„ì´ ë©ˆì·„ìŒ)
  const bubble = document.createElement('div');
  bubble.className = 'bubble';
  bubble.textContent = 'ğŸ«§';

  const rect = elGame.getBoundingClientRect();
  const hudRect = elHud.getBoundingClientRect();
  const tipRect = elTip.getBoundingClientRect();

  let topSafe = (hudRect.bottom - rect.top) + 14;
  let bottomSafe = (rect.bottom - tipRect.top) + 14;

  topSafe = clamp(topSafe, 70, rect.height - 140);
  bottomSafe = clamp(bottomSafe, 70, rect.height - 140);

  const padding = 18;
  const w = 72, h = 72;

  let yMin = topSafe;
  let yMax = rect.height - h - bottomSafe;

  if (yMax < yMin + 10) {
    const midTop = rect.height * 0.30;
    const midBot = rect.height * 0.78;
    yMin = clamp(midTop, 60, rect.height - h - 60);
    yMax = clamp(midBot, yMin + 10, rect.height - h - 60);
  }

  const x = rand(padding, rect.width - w - padding);
  const y = rand(yMin, yMax);

  bubble.style.left = x + 'px';
  bubble.style.top = y + 'px';

  // âœ… í´ë¦­/í„°ì¹˜ ì²˜ë¦¬
  bubble.addEventListener('pointerdown', (e) => {
    e.preventDefault();
    e.stopPropagation();

    const r = elGame.getBoundingClientRect();
    const px = e.clientX - r.left;
    const py = e.clientY - r.top;

    onHitBubble(px, py);
  }, { passive: false });

  bubble.addEventListener('touchstart', (e) => {
    e.preventDefault();
    e.stopPropagation();

    const t = e.changedTouches[0];
    const r = elGame.getBoundingClientRect();
    const px = t.clientX - r.left;
    const py = t.clientY - r.top;

    onHitBubble(px, py);
  }, { passive: false });

  elGame.appendChild(bubble);
  activeBubble = bubble;

  const life = bubbleLifeMs;
  window.setTimeout(() => {
    if (running && activeBubble === bubble) {
      removeActiveBubble();
      onMissBubble();
    }
  }, life);

  scheduleNextSpawn();
}

      function scheduleNextSpawn() {
        if (!running) return;
        if (spawnTimer) window.clearTimeout(spawnTimer);
        const wait = rand(SPAWN_MIN_MS, SPAWN_MAX_MS);
        spawnTimer = window.setTimeout(spawnBubble, wait);
      }

      function onHitBubble(x, y) {
  if (!running) return;

  burstSparks(x, y); // âœ… ì„±ê³µ ì‹œ âœ¨ íŒŒí‹°í´

  score += 1;
  combo += 1;
  bestCombo = Math.max(bestCombo, combo);

  setDanger(danger - DANGER_DROP_ON_HIT);

  bubbleLifeMs = clamp(BUBBLE_LIFE_START_MS - score * 13, BUBBLE_LIFE_MIN_MS, BUBBLE_LIFE_START_MS);

  if (score === 1) setTip('ì¢‹ì•„! ê±°í’ˆ íƒ€ê³  ì•ìœ¼ë¡œ! ğŸŸ');
  else if (score === 6) setTip('ìƒì–´ê°€ ë©€ì–´ì§€ëŠ” ëŠë‚Œâ€¦ ê³„ì†! âœ¨');
  else if (score === 12) setTip('ì˜¤ëŠ˜ì€ ë°”ë‹¤ê°€ ì§„ì§œ ë§‘ë‹¤! ğŸŒŠ');
  else if (score === 20) setTip('ë„ˆ, ë°”ë‹¤ ìµœê°• ëŸ¬ë„ˆ ì•„ë‹ˆì•¼? ğŸ˜„');

  removeActiveBubble();
  updateHUD();
}

      function onMissBubble() {
        if (!running) return;

        combo = 0;
        setDanger(danger + DANGER_PENALTY_MISS);

        // ë†“ì¹˜ë©´ ì•ˆë‚´ëŠ” ë°ê²Œ, ë¶€ë‹´ ì—†ì´
        const lines = [
          'ê´œì°®ì•„! ë‹¤ìŒ ê±°í’ˆ ì¡ì ğŸ«§',
          'ì†ëì´ ë¯¸ë„ëŸ¬ì¡Œë„¤! ë‹¤ì‹œ! ğŸ˜„',
          'ìƒì–´ê°€ ì¡°ê¸ˆ ê°€ê¹Œì›Œì¡Œì–´â€¦ ë¹¨ë¦¬! ğŸ¦ˆ'
        ];
        setTip(lines[Math.floor(Math.random() * lines.length)]);

        updateHUD();
      }

      // ====== ê²Œì„ ë£¨í”„ ======
      function tick(ts) {
        if (!running) return;
        if (!lastTick) lastTick = ts;

        const dt = (ts - lastTick) / 1000;
        lastTick = ts;

        // ì‹œê°„ ê°ì†Œ
        timeLeft = Math.max(0, timeLeft - dt);

        // ìœ„í—˜ë„ëŠ” ì‹œê°„ì— ë”°ë¼ ìƒìŠ¹(ìƒì–´ê°€ ë‹¤ê°€ì˜´)
      const timeFactor = 1 + (1 - timeLeft / ROUND_SECONDS) * 0.6;
// ì´ˆë°˜ 1.0 â†’ í›„ë°˜ 1.6ë°°

setDanger(danger + DANGER_RISE_PER_SEC * timeFactor * dt);

        // ê±°ì˜ ì¡í ë•ŒëŠ” ìƒì–´ ê²½ê³  ë¬¸êµ¬(ë„ˆë¬´ ìì£¼ ë°”ë€Œì§€ ì•Šê²Œ ì¡°ê±´ë¶€)
        const pct = clamp(danger, 0, 100);
        if (pct >= SHARK_SHOW_AT && pct < CAUGHT_AT) {
          setTip('ìƒì–´ê°€ ì½”ì•! ê±°í’ˆì„ ë” ë¹ ë¥´ê²Œ! ğŸ«§ğŸ¦ˆ');
        }

        updateHUD();

        // ì¢…ë£Œ ì¡°ê±´
        if (danger >= CAUGHT_AT) {
          endGame(false); // ì¡í˜
          return;
        }
        if (timeLeft <= 0) {
          endGame(true); // ì‹œê°„ ë²„íŒ€(ì„±ê³µ)
          return;
        }

        tickRAF = requestAnimationFrame(tick);
      }

      // ====== ì‹œì‘/ì¢…ë£Œ ======
      function resetState() {
        running = false;
        score = 0;
        combo = 0;
        bestCombo = 0;
        danger = 0;
        timeLeft = ROUND_SECONDS;
        bubbleLifeMs = BUBBLE_LIFE_START_MS;

        if (spawnTimer) window.clearTimeout(spawnTimer);
        spawnTimer = null;

        if (tickRAF) cancelAnimationFrame(tickRAF);
        tickRAF = 0;
        lastTick = 0;

        removeActiveBubble();
        setDanger(0);
        updateHUD();
      }

      function startGame() {
        resetState();
        elOverlay.classList.remove('show');
        elShark.classList.remove('show');

        running = true;
        setTip('ì‹œì‘! ê±°í’ˆì„ ëˆŒëŸ¬ì„œ ë„ë§ì¹˜ì ğŸ«§');
        updateHUD();

        scheduleNextSpawn();
        tickRAF = requestAnimationFrame(tick);
      }

      function badgeFor(scoreValue, survived) {
        // ë°ì€ í†¤ì˜ ì¹­í˜¸ë“¤
        if (!survived) {
          if (scoreValue <= 5) return 'ì¹­í˜¸: ë°”ë‹¤ ì…ë¬¸ ë¬¼ê³ ê¸° ğŸŸ';
          if (scoreValue <= 12) return 'ì¹­í˜¸: ê±°í’ˆ ëŸ¬ë„ˆ ğŸ«§';
          if (scoreValue <= 25) return 'ì¹­í˜¸: ìƒì–´ ì•„ìŠ¬ì•„ìŠ¬ íšŒí”¼ì ğŸ˜…';
          return 'ì¹­í˜¸: ê±°ì˜ í”„ë¡œ(í•˜ì§€ë§Œ ìƒì–´ê°€ ë” ì§‘ìš”í–ˆìŒ) ğŸ¦ˆ';
        } else {
          if (scoreValue <= 8) return 'ì¹­í˜¸: ë¬´ì‚¬ ê·€í™˜! ğŸŒˆ';
          if (scoreValue <= 16) return 'ì¹­í˜¸: íŒŒë„ ìŠ¤í”„ë¦°í„° ğŸŒŠ';
          if (scoreValue <= 30) return 'ì¹­í˜¸: ìƒì–´ ë”°ëŒë¦¬ê¸° ì¥ì¸ âœ¨';
          return 'ì¹­í˜¸: ë°”ë‹¤ì˜ ì „ì„¤ ğŸ†ğŸŸ';
        }
      }

      function endGame(survived) {
        running = false;

        if (spawnTimer) window.clearTimeout(spawnTimer);
        spawnTimer = null;
        if (tickRAF) cancelAnimationFrame(tickRAF);
        tickRAF = 0;

        removeActiveBubble();

        // ì¡í ë•ŒëŠ” ìƒì–´ë¥¼ í™•ì‹¤íˆ ë³´ì—¬ì£¼ê¸°
        if (!survived) {
          elShark.classList.add('show');
          elResultTitle.textContent = 'ì¡í˜”ë‹¤! ğŸ¦ˆ';
        } else {
          elShark.classList.remove('show');
          elResultTitle.textContent = 'íƒˆì¶œ ì„±ê³µ! ğŸŸâœ¨';
        }

        elResultLine.textContent = `ì ìˆ˜ ${score}, ìµœê³  ì½¤ë³´ ${bestCombo}`;
        elResultBadge.textContent = badgeFor(score, survived);
        elOverlay.classList.add('show');

        setTip('ë‹¤ì‹œ í•˜ë ¤ë©´ â€œë‹¤ì‹œ í•˜ê¸°â€ë¥¼ ëˆŒëŸ¬ì¤˜!');
      }

      // ====== ë²„íŠ¼/ì´ë²¤íŠ¸ ======
      function bindStartButton(btn){
  const go = (e) => {
    e.preventDefault();
    e.stopPropagation();
    startGame();
  };
  btn.addEventListener('click', go);
  btn.addEventListener('pointerdown', go, { passive: false });
  btn.addEventListener('touchstart', go, { passive: false });
}

bindStartButton(elStartBtn);
bindStartButton(elAgainBtn);

      // ê²Œì„ í™”ë©´ì„ ëˆŒëŸ¬ë„ ìŠ¤í¬ë¡¤/ì¤Œ ë˜ì§€ ì•Šê²Œ(ì•ˆì „ì¥ì¹˜)
      elGame.addEventListener('pointerdown', (e) => {
        if (!running) return;
        // ë²„ë¸”ì´ ì•„ë‹Œ ê³³ì„ ëˆ„ë¥´ë©´ ì½¤ë³´ëŠ” ëŠì§€ ì•Šê³ , ê·¸ëƒ¥ â€œí—›í´ë¦­â€ ëŠë‚Œë§Œ(ë„ˆë¬´ ë²Œ ì£¼ì§€ ì•Šê²Œ)
        // ëŒ€ì‹  ìœ„í—˜ë„ê°€ ì‚´ì§ ì˜¤ë¥´ë„ë¡ í•˜ê³  ì‹¶ìœ¼ë©´ ì•„ë˜ ì£¼ì„ì„ í’€ì–´ë„ ë¨.
        // setDanger(danger + 1.2);
        e.preventDefault();
      }, { passive: false });

      // ====== ì´ˆê¸° ì„¸íŒ… ======
      makeBgBubbles();
      resetState();
      setTip('ğŸ«§ ê±°í’ˆì„ ë¹¨ë¦¬ ëˆŒëŸ¬ì„œ ìƒì–´ë¥¼ ë”°ëŒë¦¬ì! (í„°ì¹˜/í´ë¦­)');
    })();
  </script>
</body>
</html>









